<!DOCTYPE html>
<html>
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <meta charset="utf-8" />
    <script src="jquery-3.1.1.min.js"></script>
    <script src="knockout-3.4.2.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {

            var customerDetailsViewModel = function() {
                var self = this;

			          self.id = ko.observable("");
                self.time_window = ko.observable("");
                self.keywords = ko.observableArray("");
                self.SuccessMessage = ko.observable("");
                self.municipalities = ko.observableArray([]);

            self.POSTautoLocalNews = function () {

                  var the_time_window = "";
                  checkboxes = document.getElementsByName('not_foo');
                  for(var i=0, n=checkboxes.length;i<n;i++) {
                    if(checkboxes[i].checked == true) {
                      the_time_window = checkboxes[i].value;
                      break;
                    }
                  }

                  var the_municipalities = [];
                  checkboxes = document.getElementsByName('foo');
                  for(var i=0, n=checkboxes.length;i<n;i++) {
                    if(checkboxes[i].checked == true) {
                      the_municipalities.push(checkboxes[i].value);
                    }
                  }

				          var CustomerDetail = {

				                id: self.id(),
				                time_window: the_time_window,
				                keywords: self.keywords().split(','),
                        municipalities: the_municipalities,
				          }				
        $.ajax({
            url: 'https://cors-anywhere.herokuapp.com/https://iiyouepoxb.execute-api.us-west-2.amazonaws.com/Dev/postautolocalnews',
            cache: false,
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: ko.toJSON(CustomerDetail),
            success: function (data) {
              self.SuccessMessage(data)
							       self.id('');
							       self.time_window('');
							       self.keywords('');
                     self.municipalities('');
            }
					}).fail(
                  function(xhr, textStatus, err){
					               alert("Error happened "+err);
                  });
            };
        }

            var viewModel = new customerDetailsViewModel();
            ko.applyBindings(viewModel);
         });


    </script>
</head>
<div class="container">
  <form id="contact" action="" method="post">
    <h3>CityCouncilor</h3>
    <h4>Enter your email address and search queries below. We will periodically email you to let you know of upcoming public meetings relevant to you!</h4>
    <fieldset>
      <input placeholder="Your Email Address" type="email" tabindex="2" data-bind='value: id' required>
    </fieldset>
    <fieldset>
      <input placeholder="Keywords (separated by commas)" type="text" tabindex="1" data-bind='value: keywords' required autofocus>
    </fieldset>

    <script language="JavaScript">
      function toggle(source) {
        checkboxes = document.getElementsByName('foo');
        for(var i=0, n=checkboxes.length;i<n;i++) {
          checkboxes[i].checked = source.checked;
        }
      }
    </script>

    <script language="JavaScript">
      function onlyOne(checkbox) {
        var checkboxes = document.getElementsByName('not_foo')
        checkboxes.forEach((item) => {
          if (item !== checkbox) item.checked = false
        })
      }
    </script>

    <h2>Area(s) of interest</h2>
    <input type="checkbox" onClick="toggle(this)" /> Select all<br/>
    <input type="checkbox" name="foo" value="Alameda"> Alameda<br/>
    <input type="checkbox" name="foo" value="Burlingame"> Burlingame<br/>
    <input type="checkbox" name="foo" value="Cupertino"> Cupertino<br/>
    <input type="checkbox" name="foo" value="Hayward"> Hayward<br/>
    <input type="checkbox" name="foo" value="Hercules"> Hercules<br/>
    <input type="checkbox" name="foo" value="Metropolitan Transportation Commission"> Metropolitan Transportation Commission<br/>
    <input type="checkbox" name="foo" value="Mountain View"> Mountain View<br/>
    <input type="checkbox" name="foo" value="Oakland"> Oakland<br/>
    <input type="checkbox" name="foo" value="San Francisco"> San Francisco<br/>
    <input type="checkbox" name="foo" value="San Jose"> San Jose<br/>
    <input type="checkbox" name="foo" value="San Leandro"> San Leandro<br/>
    <input type="checkbox" name="foo" value="San Mateo County"> San Mateo County<br/>
    <input type="checkbox" name="foo" value="Santa Clara"> Santa Clara<br/>
    <input type="checkbox" name="foo" value="South San Francisco"> South San Francisco<br/>
    <input type="checkbox" name="foo" value="Stockton"> Stockton<br/>
    <input type="checkbox" name="foo" value="Sunnyvale"> Sunnyvale<br/>

    <fieldset>
      <h2>Time window of interest</h2>
      <input type="checkbox" name="not_foo" value="upcoming_only" onclick="onlyOne(this)"> Upcoming<br/>
      <input type="checkbox" name="not_foo" value="this_week" onclick="onlyOne(this)"> Past Week<br/>
      <input type="checkbox" name="not_foo" value="this_month" onclick="onlyOne(this)"> Past Month<br/>
      <input type="checkbox" name="not_foo" value="last_six_months" onclick="onlyOne(this)"> Past 6 Months<br/>
    </fieldset>

    <fieldset>
      <button name="submit" type="submit" id="contact-submit" data-submit="...Sending" data-bind="click: $root.POSTautoLocalNews" > Save </button>
      <span style ="color: darkolivegreen" data-bind='text : SuccessMessage' />
    </fieldset>

    <p class="copyright">Adapted from design by <a href="https://colorlib.com" target="_blank" title="Colorlib">Colorlib</a></p>
  </form>
</div>
</html>
